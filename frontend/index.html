<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>StocksFirst</title>
</head>
<body>
    <h1>StocksFirst</h1>
    <div class="container">
        <div class="search-div">
            <input type="text" id="ticker-search" placeholder="Search Ticker Name"> 
            <button onclick="searchTicker()">Submit</button>
        </div>
        <div class="tile-container">
            <div class="row-one">
                <div class="tile" id="result-container">
                    <h3>AAPL</h3>
                    <p>Price: </p>
                    <p>Change Percentage: </p>
                    <p>Volume: </p>   
                </div>
                <div class="tile" id="best-performer-2">
                    <h3>AAPL</h3>
                    <p>Price: </p>
                    <p>Change Percentage: </p>
                    <p>Volume: </p>   
                </div>
            </div>
            <div class="row-two">
                <div class="tile" id="best-performer-3">
                    <h3>AAPL</h3>
                    <p>Price: </p>
                    <p>Change Percentage: </p>
                    <p>Volume: </p>    
                </div>
                <div class="tile" id="best-performer-4">
                    <h3>AAPL</h3>
                    <p>Price: </p>
                    <p>Change Percentage: </p>
                    <p>Volume: </p>   
                </div>
            </div>
    </div>
</body>
<script>
    var xhr = null;

    //This adds an event listener to all of my tiles
    var selectedTile = new Array();
    const tileList = document.querySelectorAll(".tile");
    tileList.forEach(function(tile) {

        tile.addEventListener("click", function() {
            if(tile.style.backgroundColor == 'lightblue') {
                tile.style.backgroundColor = 'white';
            } else {
                //Deselect any other tile.
                tileList.forEach(function(tile) {
                    tile.style.backgroundColor = 'white';
                })
                //select current tile
                tile.style.backgroundColor = 'lightblue';
            }
        })
    });

    document.getElementById("ticker-search").addEventListener("keyup", function(event) {
        if(event.keyCode == 13) {
            searchTicker()
        }
    });

    getXmlHttpRequestObject = function() {
        if(!xhr){
            xhr = new XMLHttpRequest();
        }
        return xhr;
    };

    window.onload = function(){
        loadHistory();
    };

    function loadHistoryCallback() {
        if(xhr.readyState == 4 && xhr.status == 200){
            console.log("Load response received.");
            historyDiv = document.getElementById('history-container');
            historyDiv.innerHTML = xhr.responseText;
        }
    };

    function loadHistory() {
        console.log("Loading user search history...");
        xhr = getXmlHttpRequestObject();
        xhr.onreadystatechange = loadHistoryCallback;

        //Asynchronous request
        xhr.open("GET", "http://localhost:6969/", true);
        xhr.send(null);
    };

    function searchTickerCallback(){
        console.log("We are in the callback");
        if(xhr.readyState == 4 && xhr.status == 200) {
            console.log("Search response received.");
            resultDiv = document.getElementById('result-container');
            resultDiv.innerHTML = `<p>${xhr.responseText}</p>`;
        }
    }

    function searchTicker() {
        tickerToSearch = document.getElementById('ticker-search').value;
        if(!tickerToSearch){
            console.log("No ticker entered.");
            return;
        }
        console.log("Searching ticker " + tickerToSearch);
        xhr = getXmlHttpRequestObject();
        xhr.onreadystatechange = searchTickerCallback;

        //Asynchronous request
        xhr.open("POST", "http://localhost:6969/", true);
        xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        xhr.send(JSON.stringify({"data": tickerToSearch}));
    }
</script>
</html>